<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mengalihkan…</title>
  <script>
    const BASE_PATH = "/shortlink"; // user/org pages: "" ; project pages: "/<repo>"
  </script>
  <link rel="stylesheet" href="style.css"/>
</head>
<body class="center">
  <div class="card">
    <h1>Mengalihkan…</h1>
    <p id="info" class="muted">Memuat peta tautan</p>
  </div>

  <script>
    (async function(){
      const BASE = (BASE_PATH||"");
      const info = document.getElementById('info');

      const base = BASE.replace(/\/+$/,''); 
      let slug = location.pathname;
      if (base && slug.startsWith(base)) slug = slug.slice(base.length);
      slug = decodeURIComponent(slug).replace(/^\/+|\/+$/g,'').toLowerCase();

      if (!slug){ location.replace((BASE||"") + "/"); return; }

      const mapUrl = (BASE||"") + "/links.json?ts=" + Date.now();
      try{
        const res = await fetch(mapUrl, {cache:"no-store"});
        if (!res.ok) throw new Error("links.json tidak ditemukan");
        const links = await res.json();

        const target = links[slug];
        if (target){
          const qs = location.search || "";
          const hs = location.hash || "";
          const finalUrl = target + qs + hs;
          info.textContent = "→ " + finalUrl;
          location.replace(finalUrl);
        }else{
          info.innerHTML = `Slug <code>${slug}</code> tidak ada. <a href="${(BASE||"") + "/"}">Kembali</a>`;
        }
      }catch(e){
        info.textContent = "Gagal memuat links.json: " + e.message;
      }
    })();
  </script>
</body>
</html>
